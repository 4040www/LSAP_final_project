### 問題定義
  * **痛點 (Pain Point)**：Gitea 原生缺乏儲存空間限制，單一使用者如果上傳超大檔案，可能會把伺服器硬碟塞滿，導致整個服務癱瘓。
  * **解決方案**：我們實作了 **「Repository 儲存容量上限管理器」**，透過 Linux 系統層級的 Hook 與排程來解決這個問題。
  * **核心功能**：
    1.  **主動防禦**：在 Push 階段直接攔截超額檔案。
    2.  **動態配置**：透過設定檔管理不同使用者的額度。
    3.  **監控預警**：定期掃描並產生 Prometheus 數據供監控使用。

-----
### 架構解說
  * **設定檔**：`repo_quotas.conf`。
      * 我們設計了一個簡單的設定檔，可以針對特定 Repo 設定額度（以我們實作為例是 1MB），也有全域的預設值。
  * **運作流程**：
      * 當使用者 `git push` 時，`pre-receive hook` 會自動計算當前大小，如果加上新檔案後會超標，就直接回傳 exit 1 拒絕寫入。
  * **Cron Job 定期掃描**:
      * 我們設定了每天凌晨三點執行一次檢查腳本 `0 3 * * * /var/lib/gitea/data/scan_quotas.sh`，會產出標準的 Prometheus Metrics，包含 `gitea_repo_usage_bytes` 和 `quota_exceeded` 狀態。網管可以直接在 Grafana 看到這些數據。

-----

### 技術亮點與結語
1.  **非侵入式架構**：我們沒有修改 Gitea 的原始碼，而是利用標準的 Git Hook 機制，這讓系統升級更容易。
2.  **彈性**：修改 `repo_quotas.conf` 後不需要重啟 Gitea，規則即時生效。
3.  **可移植性**：我們已經模組化這套腳本，剛剛也成功從我的測試環境整合到 Demo 環境。